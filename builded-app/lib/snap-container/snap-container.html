<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../snap-widget/snap-widget.html">
<polymer-element name="snap-container" attributes="layout">
  <template>
    <style>

      :host {
        display: block;
      }

      :host #content {
        overflow: auto;
      }

      :host #content > * {
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
      }

      :host[layout="horizontal"] #content > * {
        display: block;
        float: left;
      }

      :host[layout="vertical"] #content > * {
        display: block;
        width: 100%;
      }

    </style>
    <snap-widget name="Container">
      <div id="content" class="view">
        <content></content>
      </div>
      <div class="edit">
      </div>
    </snap-widget>
  </template>
  <script>
    (function() {

      var filter = Array.prototype.filter;

      Polymer('snap-container', {

        gutter: 1,
        layout: 'horizontal',

        ready: function() {
          this.async(this.applyLayout);
        },

        layoutChanged: function() {
          this.async(this.applyLayout);
        },

        applyLayout: function() {
          var self = this;
          var nodes = this.querySelectorAll('.view > *');
          nodes = filter.call(nodes, function(n) {
            return n.parentElement === self;
          });
          var count = nodes.length;
          var percent = 100-((count-1)*this.gutter);
          var width = (percent/count) + '%';
          while(count--) {
            el = nodes[count];
            if(this.layout === 'horizontal') {
              el.style.width = width;
              if(count !== nodes.length-1) {
                el.style.marginRight = this.gutter + '%';
              }
            } else {
              el.removeAttribute('style');
              el.style.marginBottom = this.gutter + '%';
            }
          }
        }

      });

    }());
  </script>
</polymer-element>